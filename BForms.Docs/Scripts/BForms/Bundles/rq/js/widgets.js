define("bforms-grid",["jquery","jquery-ui-core","bforms-pager","bforms-editable","bforms-ajax","bforms-namespace"],function(){var a=function(b){this.options=$.extend(true,{},this.options,b);this._init()};a.prototype.options={$toolbar:$([]),gridItem:".bs-item",gridItemDetails:".bs-details",gridDetailsContainer:".bs-rowDetails",hasOrder:true,orderContainerSelector:".title",orderElemSelector:".bs-orderColumn",multipleOrder:false,defaultPage:1,currentPage:1,goTopElement:null,uniqueName:null,gridContainerSelector:".grid_rows",gridCountContainerSelector:"h2 > .badge",gridHeaderSelector:"h2",filterSelector:".bs-filter",resetGridSelector:".bs-resetGrid",addSelector:".bs-triggerAdd",expandToggleSelector:".bs-toggleExpand",rowsContainerSelector:".grid_rows_wrapper",rowSelector:".grid_row",rowHeaderSelector:"header",rowDetailsSelector:".grid_row_details",rowActionsContainerSelector:".bs-row_controls",rowDetailsSuccessHandler:null,rowActions:[],updateRowUrl:null,hasRowCheck:true,rowCheckSelector:'.bs-row_check:not([disabled="disabled"])',headerCheckSelector:".check_all > input",groupActionsSelector:".bs-group_actions",pager:null,pagerUrl:null,onRefresh:null,detailsSelector:".bs-expand",detailsUrl:null,multipleDetails:true,removeDetailsOnCollapse:false,validationSummaryContainer:".bs-validation_summary",validationRowActionsContainer:".bs-validation_row_action",errorRowContainer:".bs-validation_row",errorCloseSelector:".bs-form-error .close",noResultsRowSelector:".bs-noResultsRow",sortable:true,rowClickExpandable:true,defaultFilterButtons:[{btnSelector:".js-all",filter:function(b){return true},},{btnSelector:".js-none",filter:function(b){return false},}]};a.prototype._refreshModel={OrderableColumns:[],Search:{},Page:1,PageSize:5,quickSearch:""};a.prototype._initialModel={PageSize:5};a.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"grid needs a unique name or the element on which it is aplied has to have an id attr"}this._initDefaultOptions();this._initSelectors();this.options.hasRowCheck=this.$actionsContainer.length>0;this.hasDetails=this.options.detailsSelector&&this.options.detailsUrl;this._addDelegates();this.refreshModel=$.extend(true,{},this.element.data("settings"),this._refreshModel);this.refreshModel.OrderColumns=this._getColumnsOrder();this._currentResultsCount=this.$gridCountContainer.text();this.$pager=this.element.find(".bs-pager").bsPager({pagerUpdate:$.proxy(this._evOnPageChange,this),pagerGoTop:$.proxy(this._evOnPagerGoTop,this)});this.refreshModel.PageSize=parseInt(this.$pager.bsPager("getPageSize"),10)||this.refreshModel.PageSize;this._initialModel.PageSize=this.refreshModel.PageSize;this.needsRefresh=false;if(this.options.sortable&&($.browser==null||$.browser.mobile==false)){this._initSortable()}this.$rowsContainer.find(this.options.rowSelector).each($.proxy(function(b,c){this._initInitialDetails($(c))},this))};a.prototype._initDefaultOptions=function(){if(typeof this.options.filterButtons!=="undefined"&&$.isArray(this.options.filterButtons)){this.options.filterButtons=this.options.filterButtons.concat(this.options.defaultFilterButtons)}else{this.options.filterButtons=this.options.defaultFilterButtons}};a.prototype._addDelegates=function(){if(this.hasDetails){this.element.on("click",this.options.detailsSelector,$.proxy(this._evOnDetailsClick,this));if(this.options.rowClickExpandable){this.element.on("click",this.options.rowSelector,$.proxy(this._onRowClick,this))}}if(this.options.hasOrder){this.element.on("click",this.options.orderContainerSelector+" "+this.options.orderElemSelector,$.proxy(this._evOnOrderChange,this))}if(this.options.hasRowCheck){this.$headerCheck=this.element.find(this.options.headerCheckSelector);this.element.on("click",this.options.rowCheckSelector,$.proxy(this._evOnRowCheckChange,this));this.element.on("change",this.options.headerCheckSelector,$.proxy(this._evOnHeaderCheckSelector,this));for(var b=0;b<this.options.filterButtons.length;b++){var c=this.options.filterButtons[b];(function(e,d){d.$actionsContainer.on("click",e.btnSelector,$.proxy(function(f){f.preventDefault();this.$rowsContainer.find(d.options.rowCheckSelector).parents(d.options.rowSelector).each($.proxy(function(j,i){var g=$(i);var h=e.filter.call(this,g);g.find(this.options.rowCheckSelector).prop("checked",h);h?g.addClass("selected"):g.removeClass("selected")},this));this._evOnRowCheckChange(null,$(f.currentTarget))},d))})(c,this)}if(this.options.gridActions!=null){for(var b=0;b<this.options.gridActions.length;b++){var c=this.options.gridActions[b];(function(f,e){if(f.popover){var d=e.$actionsContainer.find(f.btnSelector);d.popover({html:true,content:$(".popover-content").html(),placement:"bottom"});d.on("show.bs.popover",$.proxy(function(g){var h=d.data("bs.popover").tip();h.one("click",".bs-confirm",$.proxy(function(i){i.preventDefault();d.popover("toggle");f.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this)},this));h.one("click",".bs-cancel",function(i){i.preventDefault();d.popover("toggle")})},e))}else{e.$actionsContainer.on("click",f.btnSelector,$.proxy(function(g){f.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this)},e))}})(c,this)}}}this.element.on("click",".edit_col",$.proxy(this._evOnCellEdit,this));this.element.on("click",this.options.resetGridSelector,$.proxy(this._evResetGrid,this));this.element.on("click",this.options.errorCloseSelector,$.proxy(this._evOnErrorRemove,this));this.element.on("click",this.options.expandToggleSelector,$.proxy(this._evOnExpandToggle,this));this.element.on("click",this.options.addSelector,$.proxy(function(){if(this.options.$toolbar!=null&&typeof this.options.$toolbar.bsToolbar==="function"){this.options.$toolbar.bsToolbar("toggleControl","add")}},this))};a.prototype._initSelectors=function(){this.$rowsContainer=this.element.find(this.options.rowsContainerSelector);this.$gridContainer=this.element.find(this.options.gridContainerSelector);this.$gridCountContainer=this.element.find(this.options.gridCountContainerSelector);this.$filterIcon=this.element.find(this.options.filterSelector);this.$resetGridButton=this.element.find(this.options.resetGridSelector);this.$gridOrderContainer=this.element.find(this.options.orderContainerSelector);this.$actionsContainer=this.element.find(this.options.groupActionsSelector);this.$gridHeader=this.element.find(this.options.gridHeaderSelector);this.$expandToggle=this.element.find(this.options.expandToggleSelector)};a.prototype._createActions=function(e,b){for(var d=0;d<e.length;d++){var c=e[d];if(typeof c.handler!=="function"&&typeof c.init!=="function"){throw"action with selector "+c.btnSelector+" has no click handler and no init handler"}if(typeof c.init==="function"){c.init.call(this,c,b,this)}if(typeof c.handler==="function"){b.on("click",c.btnSelector,{options:c},$.proxy(function(f){var g=f.data.options;g.handler.call(this,f,g,$(f.target).closest(this.options.rowSelector),this)},this))}}};a.prototype.search=function(b,c){this.refreshModel.Page=1;if(c){this.refreshModel.quickSearch=b;this.refreshModel.Search=null}else{this.refreshModel.Search=b;this.refreshModel.quickSearch=null}this._showFilterIcon();if(c&&this.refreshModel.quickSearch==""){this._hideFilterIcon()}this._getPage()};a.prototype.reset=function(b,c){this.refreshModel.Page=1;this.refreshModel.Search=b;this.refreshModel.quickSearch=null;this._hideFilterIcon();if(c!==true){this._getPage()}};a.prototype.refresh=function(c,b){this._getPage()};a.prototype.add=function(c){var b=$(c);this._currentResultsCount++;this._changeCount();if(this.$rowsContainer.hasClass("no_results")){this.$rowsContainer.removeClass("no_results");this.$rowsContainer.children().remove()}this.$rowsContainer.prepend(b.find(this.options.rowSelector));this.$pager.bsPager("updateTotal",this._currentResultsCount);this.toggleBulkActions();this.$rowsContainer.show();this.element.find(this.options.noResultsRowSelector).remove()};a.prototype._createDetails=function(){var b=this.element.find(this.options.detailsContainerSelector).each(function(d,c){this._createDetailsHelper($(c))},this)};a.prototype._createDetailsHelper=function(b){var c=b.closest(this.options.rowSelector);if(!c.data("objid")<0){throw"row with index "+c.index()+" has no objId set"}b.prepend('<a href="#" class="expand">&nbsp;</a>');var d=b.find(".expand");d.on("click",this._evOnDetailsClick,this)};a.prototype._evOnDetailsClick=function(f,d){f.preventDefault();f.stopPropagation();var b=$(f.currentTarget).closest(this.options.rowSelector);if(d!=null&&d.removeErrors){if(b.find(this.options.errorCloseSelector).length){b.find(this.options.errorCloseSelector).trigger("click");this._updateExpandToggle();return}}if(b.hasClass("open")){b.removeClass("open");b.children(this.options.rowDetailsSelector).stop(true,true).slideUp(400);this._updateExpandToggle();return}if(b.data("hasdetails")){this._handleDetails(b);return}var g={items:[{Id:b.data("objid"),GetDetails:true}]};var c={name:this.options.uniqueName+"|details|"+b.data("objId"),url:this.options.detailsUrl,data:g,callbackData:{sent:g,row:b,id:b.data("objid")},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"};$.bforms.ajax(c)};a.prototype._detailsAjaxSuccess=function(c){var b=$(c.RowsHtml);b.find(this.options.rowSelector).each($.proxy(function(f,g){var e=$(g);var d=this._getRowElement(e.data("objid"));d.find(this.options.rowHeaderSelector).replaceWith(e.find(this.options.rowHeaderSelector));d.append(e.find(this.options.rowDetailsSelector).hide());c.$detailsHtml=d.find(this.options.rowDetailsSelector);this._trigger("beforeRowDetailsSuccess",0,{$row:d,data:c});d.stop(true,true).slideDown(800);this._handleDetails(d);d.data("hasdetails",true);this._createActions(this.options.rowActions,d);this._trigger("afterRowDetailsSuccess",0,{$row:d,data:c})},this))};a.prototype._detailsAjaxError=function(e){if(e.Message){var d=arguments[4].row;if(typeof d!=="undefined"&&d!=null){var b=d.find(".bs-validation_row");if(b.length==0){b=$('<div class="col-12 col-sm-12 col-lg-12 bs-validation_row"></div>');d.find(this.options.rowHeaderSelector).after(b)}this._addError(e.Message,b,true);this._updateExpandToggle()}else{var c=$(this.element).find(".bs-validation_summary");if(c.length==0){c=$('<div class="col-12 col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(c)}this._addError(e.Message,c)}}};a.prototype._expandGridRow=function(b){b.addClass("open");b.find(this.options.rowDetailsSelector).stop(true,true).slideDown(800)};a.prototype._handleDetails=function(d){var c=this.element.find(this.options.rowSelector+".open"),e=false;if(c.length>0&&!this.options.multipleDetails){c.removeClass("open");var b=c.children(this.options.rowDetailsSelector);b.hide();if(this.options.removeDetailsOnCollapse){b.remove();c.data("hasdetails",false)}this._expandGridRow(d);$.bforms.scrollToElement(d);e=true}if(!e){this._expandGridRow(d)}this._updateExpandToggle()};a.prototype._getMultiDetails=function(d,c){var b=this.$rowsContainer.find(this.options.rowSelector).length==c.length?this.$rowsContainer:c;$.bforms.ajax({name:this.options.uniqueName+"|multiDetails",url:this.options.detailsUrl,data:{items:d},callbackData:{items:d},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"})};a.prototype._evOnPageChange=function(c,b){this.refreshModel.Page=b.page;var d=true;if(b.pageSize){this.refreshModel.PageSize=b.pageSize;d=false;if(b.pageSize!=this._initialModel.PageSize){this._showResetGridButton()}else{this._hideResetGridButton()}}this._getPage(d)};a.prototype._evOnPagerGoTop=function(c){var b=$([]);if(this.options.goTopElement!==null){b=$(this.options.goTopElement)}else{b=this.$gridHeader}if(b.length){$.bforms.scrollToElement(b)}};a.prototype._evOnOrderChange=function(c){c.preventDefault();if(!this._currentResultsCount){return}var d=$(c.currentTarget);var k="";var l="";var m=0;if(d.hasClass("sort_asc")){k="sort_desc";m=2}else{if(!d.hasClass("sort_desc")){k="sort_asc";m=1}}var h=d.parent().data("name");var j={Name:h,Type:m};if(this.options.multipleOrder){var b=false;for(var f=0;f<this.refreshModel.OrderableColumns.length;f++){var g=this.refreshModel.OrderableColumns[f];if(g.Name==h){if(m==0){this.refreshModel.OrderableColumns.splice(f,1)}else{g.Type=m}b=true;break}}if(!b){this.refreshModel.OrderableColumns.push(j)}d.removeClass("sort_asc").removeClass("sort_desc")}else{this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc").removeClass("sort_desc");this.refreshModel.OrderableColumns=[];this.refreshModel.OrderableColumns.push(j)}if(m!=0){d.addClass(k)}this._getPage();if(!this._isInitialState()){this._showResetGridButton()}else{this._hideResetGridButton()}};a.prototype._evOnHeaderCheckSelector=function(f){var d=$(f.currentTarget).prop("checked");this.element.find(this.options.rowCheckSelector).prop("checked",d);var b=this.element.find(this.options.rowCheckSelector).parents(this.options.rowSelector);if(d){b.addClass("selected")}else{b.removeClass("selected")}var c=this.$actionsContainer.children("button");if(d){c.show();this._showResetGridButton()}else{c.hide();this._hideResetGridButton()}};a.prototype._evOnRowCheckChange=function(h,d){var b;if(h&&typeof h.stopPropagation=="function"){h.stopPropagation();b=$(h.currentTarget)}else{b=d}if(typeof b!=="undefined"&&b!=null){var c=b.closest(this.options.rowSelector);if(b.prop("checked")){c.addClass("selected")}else{c.removeClass("selected")}}var g=this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).length;var f=this.$actionsContainer.children("button");if(g>0){f.show();this._showResetGridButton();if(g==this.element.find(this.options.rowCheckSelector).length){this.$headerCheck.prop("indeterminate",false)}else{this.$headerCheck.prop("indeterminate",true)}this.$headerCheck.prop("checked",true)}else{f.hide();this._resetHeaderCheck();this._hideResetGridButton()}};a.prototype._resetHeaderCheck=function(){if(this.$headerCheck){this.$headerCheck.prop("indeterminate",false);this.$headerCheck.prop("checked",false);this.$actionsContainer.children("button").hide()}};a.prototype._evOnCellEdit=function(d){d.preventDefault();d.stopPropagation();var g=$(d.currentTarget);var f=g.parent().index();var c=this.$gridOrderContainer.children(":eq("+f+")").children("form");var b=c.clone();var h=g.closest(this.options.rowSelector).data("id");b.find("*").each(function(j,i){var e=$(i);if(e.attr("id")){e.attr("id",e.attr("id")+"_"+h+"_"+f)}});g.after(b);g.hide();b.show()};a.prototype._evOnCellSave=function(c){c.preventDefault();var b=$(c.cuurentTarget).closest("form");$.validator.unobtrusive.parse(b);if(!b.valid()){return}var d=b.parseForm()};a.prototype._evResetGrid=function(b){b.stopPropagation();var c=false;this._resetHeaderCheck();this._uncheckAllRows();this._resetOrder();this._hideResetGridButton(true);this._removeErrors();if(this.refreshModel.PageSize!=this._initialModel.PageSize){c=true;this.refreshModel.PageSize=this._initialModel.PageSize;this.$pager.bsPager("selectValue",this.refreshModel.PageSize)}if(this.options.$toolbar!=null&&this.$filterIcon.is(":visible")){this.options.$toolbar.bsToolbar("reset")}if(c===true){this.refreshModel.Page=1}this._getPage()};a.prototype._evOnErrorRemove=function(b){if(this.element.find(".bs-form-error").length==1){window.setTimeout($.proxy(function(){this._hideResetGridButton();this._updateExpandToggle()},this),0)}};a.prototype._evOnExpandToggle=function(d){d.preventDefault();d.stopPropagation();if(this.$expandToggle.hasClass("open")){this.element.find(this.options.detailsSelector).trigger("click",{removeErrors:true})}else{var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var c=$();var f=b.map($.proxy(function(g,h){var e=$(h);if(e.data("hasdetails")){this._handleDetails(e)}else{if(e.find(this.options.errorCloseSelector).length==0){c=c.add(e);return{Id:e.data("objid"),getDetails:true}}}},this)).get();if(f.length){this._getMultiDetails(f,c)}}};a.prototype._onRowClick=function(d){if(!this._isTextSelected()){var b=$(d.currentTarget),c=$(d.target).closest(this.options.rowDetailsSelector).length>0;if(!c){b.find(this.options.detailsSelector).trigger("click")}}};a.prototype._getPage=function(d){this.needsRefresh=false;var c=this._serializeRefreshModel();if(typeof this.options.onRefresh==="function"){this.options.onRefresh.call(this,c)}var b={name:this.options.uniqueName+"|pager",url:this.options.pagerUrl,data:c,callbackData:{sent:c,pageChanged:d},context:this,success:$.proxy(this._pagerAjaxSuccess,this),error:$.proxy(this._pagerAjaxError,this),loadingElement:this.$rowsContainer,loadingDelay:100,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._pagerAjaxSuccess=function(f,e){this._currentResultsCount=f.Count||0;var b=$(f.Html),d=$("<div></div>").append(b);if(this._currentResultsCount){this.$rowsContainer.html(b.html());this.$rowsContainer.removeClass("no_results")}else{this.$rowsContainer.html(d.find(this.options.noResultsRowSelector));this.$rowsContainer.addClass("no_results")}this.$pager.bsPager("update",b.closest(".bs-pages"));if(this._currentResultsCount==0){this.$actionsContainer.hide()}else{this.$actionsContainer.show()}this._changeCount();this._resetHeaderCheck();if(e.pageChanged){$.bforms.scrollToElement(this.$gridHeader)}if(this.refreshModel.DetailsAll||this.refreshModel.DetailsCount>0){var c=this.$rowsContainer.find(this.options.rowSelector);c.each($.proxy(function(g,h){this._initInitialDetails($(h))},this))}this.toggleBulkActions();this._updateExpandToggle()};a.prototype._changeCount=function(){this.$gridCountContainer.html(this._currentResultsCount)};a.prototype._pagerAjaxError=function(c){if(c.Message){var b=$(this.element).find(".bs-validation_summary");if(b.length==0){b=$('<div class="col-12 col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(b)}this._addError(c.Message,b)}if(arguments[4]&&arguments[4].pageChanged){$.bforms.scrollToElement(this.$gridHeader)}};a.prototype._initSortable=function(){this.$gridOrderContainer.find("header").sortable({start:$.proxy(this._onSortStart,this),stop:$.proxy(this._onSortStop,this),update:$.proxy(this._onSortUpdate,this),containment:"parent",distance:10,cursor:"move",tolerance:"pointer",helper:"clone"})};a.prototype._onSortStart=function(b,c){this.$rowsContainer.addClass("loading");c.item.data("startpos",c.item.index());this.element.find(this.options.expandToggleSelector).hide()};a.prototype._onSortStop=function(b,d){var c=d.item.data("startpos");if(c==d.item.index()){this.$rowsContainer.removeClass("loading");this.$expandToggle.show()}};a.prototype._onSortUpdate=function(b,c){this.refreshModel.OrderColumns=this._getColumnsOrder();this._getPage();this.$expandToggle.show()};a.prototype._showFilterIcon=function(){this.$filterIcon.show();this._showResetGridButton()};a.prototype._hideFilterIcon=function(){this.$filterIcon.hide();this._hideResetGridButton()};a.prototype._showResetGridButton=function(){this.$resetGridButton.show()};a.prototype._hideResetGridButton=function(b){if(this._isInitialState()||b===true){this.$resetGridButton.hide()}};a.prototype._isInitialState=function(){var g=this.refreshModel.OrderableColumns.length,f=0;for(;f<g;f++){if(this.refreshModel.OrderableColumns[f].Type!=0){return false}}if(this.$filterIcon.is(":visible")){return false}if(this.refreshModel.PageSize!=this._initialModel.PageSize){return false}if(this.element.find(this.options.errorCloseSelector).length){return false}var c=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector+'[data-expandedonload="True"]');var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(c);var e=c.filter(function(){return $(this).hasClass("open")}).length,d=b.not(".open").length;if(c.length!=e||b.length!=d){return false}if(this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).length>0){return false}return true};a.prototype._uncheckAllRows=function(){var b=this.element.find(this.options.rowsContainerSelector+">"+this.options.rowSelector);this.element.find(this.options.rowCheckSelector).prop("checked",false);b.removeClass("selected")};a.prototype._resetOrder=function(){this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc sort_desc");this.refreshModel.OrderableColumns=[]};a.prototype._removeErrors=function(){this.element.find(this.options.errorCloseSelector).trigger("click")};a.prototype._updateExpandToggle=function(){if(this.element.find(this.options.detailsSelector).length>0){this.$expandToggle.show()}else{this.$expandToggle.hide()}var c=false;var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var d=b.length-b.find(this.options.errorCloseSelector).length;if(d==0){c=true}if(this._isInitialState()){this._hideResetGridButton()}else{this._showResetGridButton()}if(c){this.$expandToggle.addClass("open")}else{this.$expandToggle.removeClass("open")}};a.prototype._getColumnsOrder=function(){var b=[];this.$gridOrderContainer.find("*[data-name]").each(function(d,c){b.push({key:$(c).data("name"),value:d})});return b};a.prototype._getRowElement=function(b){return this.element.find(this.options.rowSelector+'[data-objid="'+b+'"]')};a.prototype._initInitialDetails=function(b){var c={$detailsHtml:b.find(this.options.rowDetailsSelector)};if(c.$detailsHtml.length){this._trigger("beforeRowDetailsSuccess",0,{$row:b,data:c});this._handleDetails(b);b.data("hasdetails",true);this._createActions(this.options.rowActions,b);this._trigger("afterRowDetailsSuccess",0,{$row:b,data:c})}};a.prototype._isTextSelected=function(){var b="";if(typeof window.getSelection!="undefined"){b=window.getSelection().toString()}else{if(typeof document.selection!="undefined"&&document.selection.type=="Text"){b=document.selection.createRange().text}}return b!==""};a.prototype.toggleBulkActions=function(){if(this.element.find(this.options.rowCheckSelector).length>0){this.element.find(this.options.groupActionsSelector).show()}else{this.element.find(this.options.groupActionsSelector).hide()}};a.prototype._serializeRefreshModel=function(){var b={};for(var d in this.refreshModel){if(d in this.refreshModel){var e=this.refreshModel[d];if(e instanceof Array||typeof(e)!=="object"){b[d]=this.refreshModel[d]}else{for(var c in e){if(c in e){b[c]=e[c]}}}}}return b};a.prototype.updateRow=function(f,d,e){var c={items:[{Id:f.data("objid"),GetDetails:d||true}]};var b={name:this.options.uniqueName+"|UpdateRow|"+c.objId,url:this.options.detailsUrl,data:c,callbackData:{sent:c,row:f},context:this,success:$.proxy(this._updateRowAjaxSuccess,this),error:$.proxy(this._updateRowAjaxError,this),loadingElement:f,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._updateRowAjaxSuccess=function(c,b){this.updateRows(c.RowsHtml)};a.prototype._updateRowAjaxError=function(d){if(d.Message){var c=arguments[4].row;var b=c.find(this.options.errorRowContainer);if(b.length==0){b=$('<div class="col-12 col-sm-12 col-lg-12 bs-validation_row"></div>');c.find(this.options.rowHeaderSelector).after(b)}this._addError(d.Message,b,true)}};a.prototype._rowActionAjaxError=function(d,c){if(d.Message){var b=c.find(".bs-validation_row_control");if(b.length==0){b=$('<div class="col-12 col-sm-12 col-lg-12 bs-validation_row_control"></div>');c.find(this.options.rowActionsContainerSelector).before(b)}this._addError(d.Message,b,true)}};a.prototype._addError=function(d,c,e){var b=$('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+d+"</div>");if(e){c.html(b)}else{c.append(b)}this._showResetGridButton()};a.prototype.updateRows=function(d){var b=$(d);var c=b.find(this.options.rowSelector);c.each($.proxy(function(i,k){var f=$(k),j=f.data("objid");var e=this._getRowElement(j);if(this.options.hasRowCheck){var h=e.find(this.options.rowCheckSelector).prop("checked");var g=f.find(this.options.rowCheckSelector);if(g.length){f.find(this.options.rowCheckSelector).prop("checked",h);if(h){f.addClass("selected")}}}e.find(".grid_details").each(function(o,n){var l=$(n);if(l.hasClass("bs-editable")&&l.find(".bs-readonly:visible").length==0){var m=f.find("#"+l.attr("id"));l.find(".bs-readonly").html(m.find(".bs-readonly").html());m.replaceWith(l)}});e.replaceWith(f);this._initInitialDetails(f);this._evOnRowCheckChange()},this));this._updateExpandToggle()};a.prototype.getSelectedRows=function(){var c=this.element.find(this.options.rowSelector+".selected");var b=c.map(function(e,f){var d=$(f);return{Id:d.data("objid"),GetDetails:d.hasClass("open")}}).get();return b};$.widget("bforms.bsGrid",a.prototype);return a});define("bforms-toolbar",["bforms-toolbar-advancedSearch","bforms-toolbar-add","bforms-toolbar-quickSearch","jquery","jquery-ui-core","amplify","bforms-form"],function(b,a,c){jQuery.nsx("bforms.toolbar.defaults");jQuery.nsx("bforms.toolbar.controls");var d=function(e){this.options=e;this._create()};d.prototype.options={uniqueName:null,saveTabState:true,tabContainerSelector:".grid_toolbar_form",autoInitControls:true,reset:null,controls:null};d.prototype._create=function(){$.bforms.toolbar.defaults.AdvancedSearch=b;$.bforms.toolbar.defaults.Add=a;$.bforms.toolbar.defaults.QuickSearch=c};d.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"toolbar needs a unique name or the element on which it is aplied has to have an id attr"}this._controls=[];if(this.options.autoInitControls){for(var h in $.bforms.toolbar.defaults){if(h in $.bforms.toolbar.defaults){var f=new $.bforms.toolbar.defaults[h](this.element);var e=this.element.find(f._defaultOptions.selector);if(e.length>0){f.$element=e;this._controls.push(f)}}}for(var h in $.bforms.toolbar.controls){if(h in $.bforms.toolbar.controls){var f=new $.bforms.toolbar.controls[h](this.element);var e=this.element.find(f._defaultOptions.selector);if(e.length>0){f.$element=e;this._controls.push(f)}}}}if(this.options.controls instanceof Array){for(var g=0;g<this.options.controls.length;g++){var f=new this.options.controls[g](this.element);var e=this.element.find(f._defaultOptions.selector);if(e.length>0){f.$element=e;this._controls.push(f)}}}this.subscribers=new Array();if(this.options.subscribers){this._addSubscribers(this.options.subscribers)}this._addControls(this._controls);this._expandSavedTab()};d.prototype.reset=function(){this._reset();if(typeof this.options.reset==="function"){this.options.reset.apply(this,arguments)}};d.prototype._reset=function(){var h=this.getControl("quickSearch");if(h!=null){h.$element.find("input").val("")}var e=this.getControl("advancedSearch");var f;if(e!=null){e.$container.bsForm("reset");f=e.$container.bsForm("parse")}var j=this.element.data("bformsBsToolbar");for(var g=0;g<j.subscribers.length;g++){j.subscribers[g].bsGrid("reset",f,true)}};d.prototype._addDelegates=function(){};d.prototype.controls=function(g){for(var h=0;h<g.length;h++){var f=g[h];var e=this.element.find(f._defaultOptions.selector);if(e.length>0){f.$element=e;this._controls.push(f)}}this._addControls(g)};d.prototype._addControls=function(f){if(!f){return}for(var g=0;g<f.length;g++){var e=f[g];switch(e.type){case"action":this._addAction(e);break;case"tab":this._addTab(e);e.init();break;default:this._addCustomControl(e);e.init();break}}};d.prototype._addTab=function(e){e.$container=$("#"+e.$element.data("tabid"));e.$element.on("click",{tab:e},$.proxy(this._evBtnTabClick,this))};d.prototype._expandSavedTab=function(){if(this.options.saveTabState){var g=this._getTabs();for(var e=0;e<g.length;e++){var f=g[e];if(amplify.store("slide|"+this.options.uniqueName+"|"+f.options.selector)){f.$element.trigger("click")}}}};d.prototype._addCustomControl=function(e){if(typeof e.name!=="string"||e.name.trim().length==0){throw"all controls must have a name"}if(typeof e.options.selector!=="string"||e.options.selector.trim().length==0){throw"all controls must have a name"}};d.prototype._addAction=function(f){if(typeof f.handler!=="function"){throw"action "+f.name+" must implement an event handler"}var e=this.element.find(f.selector);e.on("click",{buttonOpt:f},$.proxy(this._evBtnClick,this));var g={name:f.name,type:"action",$element:e,options:f};this._controls.push(g)};d.prototype._addSubscribers=function(f){for(var e=0;e<f.length;e++){this._addSubscriber(f[e])}};d.prototype._addSubscriber=function(e){this.subscribers.push(e)};d.prototype._evBtnClick=function(g){g.preventDefault();var f=g.data.buttonOpt;f.handler.call(this,g)};d.prototype._evBtnTabClick=function(g,h){g.preventDefault();var f=g.data.tab;if(this._selectedTab!=null&&this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab)}this._toggleTab(f)};d.prototype._toggleTab=function(g){if(g==null){return}g.$element.toggleClass("selected");if(g.name=="advancedSearch"){var f=this.getControl("quickSearch");if(f!=null){f.$element.toggleClass("selected")}}g.$container.stop(true,false).slideToggle();var e=g.$element.hasClass("selected");if(this.options.saveTabState){amplify.store("slide|"+this.options.uniqueName+"|"+g.options.selector,e)}if(e){this._selectedTab=g}else{this._selectedTab=null}};d.prototype._getTabs=function(){return this._controls.filter(function(e){return e.type=="tab"})};d.prototype.getControl=function(f){var e=$.grep(this._controls,function(g){return g.name==f});if(e!=null&&e[0]!=null){return e[0]}return null};d.prototype.toggleControl=function(f,g){var e=this.getControl(f);if(e!=null&&e.type=="tab"){if(typeof g!=="undefined"){if(g==true){if(this._selectedTab!=null){if(this._selectedTab.name!=e.name){this._toggleTab(this._selectedTab);this._toggleTab(e)}}else{this._toggleTab(e)}}else{if(this._selectedTab!=null&&this._selectedTab.name==e.name){this._toggleTab(e)}}}else{if(this._selectedTab!=null&&this._selectedTab.name!=e.name){this._toggleTab(this._selectedTab)}this._toggleTab(e)}}return e};$.widget("bforms.bsToolbar",d.prototype)});define("bforms-pager",["jquery","jquery-ui-core"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={pagesContainerSelector:".bs-pages",pageSelector:"a[data-page]",pageSizeSelector:".bs-perPage",currentPageSelector:"active",disabledPageSelector:"disabled",totalsContainerSelector:".results_number span",pageSizeContainerSelector:".results_per_page",perPageDisplaySelector:".bs-perPageDisplay",goTopButtonSelector:".bs-goTop"};a.prototype._create=function(){this._initSelectors();this._addDelegates()};a.prototype._initSelectors=function(){this.$pagesContainer=this.element.find(this.options.pagesContainerSelector);this.$totalContainer=this.element.find(this.options.totalsContainerSelector);this.$pageSizeContainer=this.element.find(this.options.pageSizeContainerSelector)};a.prototype._addDelegates=function(){this.element.on("click",this.options.pageSelector,$.proxy(this._evPageChanged,this));this.element.on("click",this.options.pageSizeSelector,$.proxy(this._evPageSizeChanged,this));this.element.on("click",this.options.goTopButtonSelector,$.proxy(this._evGoTopClick,this))};a.prototype._evPageChanged=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parent();if(c.hasClass(this.options.currentPageSelector)||c.hasClass(this.options.disabledPageSelector)){return}this._trigger("pagerUpdate",d,{page:b.data("page"),pageSize:this.element.find(this.options.pageSizeSelector).val()})};a.prototype._evPageSizeChanged=function(b){b.preventDefault();var c=$(b.currentTarget).data("value");this.element.find(".selected").removeClass("selected");$(b.currentTarget).addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>');this._trigger("pagerUpdate",b,{page:1,pageSize:$(b.currentTarget).data("value")})};a.prototype._evGoTopClick=function(b){this._trigger("pagerGoTop",b)};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c)}};a.prototype._btnClickAjaxError=function(){throw"not implemented error handler"};a.prototype.update=function(b){this.$pagesContainer.html(b.children());b.length==0?this.$pageSizeContainer.hide():this.$pageSizeContainer.show()};a.prototype.updateTotal=function(b){this.$totalContainer.html(b)};a.prototype.selectValue=function(c){var b=this.element.find(this.options.pageSizeSelector+'[data-value="'+c+'"]');if(b.length){this.element.find(".selected").removeClass("selected");b.addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>')}};a.prototype.getPageSize=function(){return this.element.find(this.options.pageSizeSelector+".selected").data("value")};$.widget("bforms.bsPager",a.prototype);return a});define("bforms-editable",["jquery","bforms-extensions","jquery-ui-core","bforms-initUI","bforms-ajax"],function(){var a=function(b){this.options=b;this._init()};a.prototype.options={uniqueName:null,isGroup:true,toggles:true,editFirst:false,editOnly:false,headerSelector:"h3",headerSelectorTrigger:"open-editable",saveClass:"btn-success",cancelClass:"btn-danger",readOnlySelector:".bs-readonly",editorSelector:"form",editModeSelector:"bs-edit_mode",url:null,additionalData:{},editSuccessHandler:null,initPlugins:null};a.prototype._init=function(){if(this.element.hasClass("bs-editable_applied")){return}if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"editable needs a unique name or the element on which it is aplied has to have an id attr"}if(!this.options.url){throw"url must have a value"}this._initSelectors();this._addDelegates();if(this.options.toggles){this.element.find(this.options.headerSelector).addClass("editable")}this._createControls();if(typeof this.options.initPlugins==="function"){this.options.initPlugins.call(this)}if(this.options.editFirst||this.options.editOnly){this._switchToEditable()}var b=this.element.bsInitUI();b.done($.proxy(function(){this._trigger("afterFormInit",{editable:this,$element:this.element})},this));this.element.addClass("bs-editable_applied")};a.prototype._initSelectors=function(){this.$readOnly=this.element.find(this.options.readOnlySelector);this.$editor=this.element.find(this.options.editorSelector);this.$header=this.element.find(this.options.headerSelector)};a.prototype._addDelegates=function(){if(this.options.toggles){this.$header.on("click",$.proxy(this._evOnHeaderClick,this))}};a.prototype.initValidation=function(){if(this.$editor.length){$.validator.unobtrusive.parse(this.$editor);this.$editor.validate()}};a.prototype._createControls=function(){if(this.options.editOnly||this.options.toggles){var c=$('<a title="Save"></a>').addClass(this.options.saveClass).addClass("btn").html('<span class="glyphicon glyphicon-ok"></span> ').attr("href","#").on("click",$.proxy(this._evOnSaveClick,this));if(this.options.toggles){var b=$('<a title="Cancel"></a>').addClass(this.options.cancelClass).addClass("btn").html('<span class="glyphicon glyphicon-remove"></span> ').attr("href","#").on("click",$.proxy(this._evOnCancelClick,this))}this.$controls=$("<span></span>").addClass("controls").append(c).append(b).appendTo(this.$header).hide()}};a.prototype._evOnHeaderClick=function(d){d.preventDefault();var b=$(d.currentTarget);var c=$(d.target);if(b.data("editmode")||(!c.hasClass(this.options.headerSelectorTrigger)&&d.currentTarget!=d.target)){return}this._switchToEditable()};a.prototype._evOnSaveClick=function(g){g.preventDefault();var c=$(g.currentTarget);var b=this.$editor;if(b.length>0){$.validator.unobtrusive.parse(b);var h=b.validate();h.settings.partialNameSearch=true;if(!b.valid()){return}}var f=this.options.prefix?b.parseForm(this.options.prefix):b.parseForm();$.extend(true,f,this.options.additionalData);f.Type=this.element.data("type");var d={name:this.options.uniqueName,url:this.options.url,data:f,callbackData:{sent:f},context:this,success:$.proxy(this._saveAjaxSuccess,this),error:$.proxy(this._saveAjaxError,this),validationError:$.proxy(this._saveAjaxValidationError,this),loadingElement:this.element,loadingClass:"loading"};$.bforms.ajax(d)};a.prototype._saveAjaxValidationError=function(c,b){if(c){var d=this.$editor.data("validator");d.showErrors(c.Errors)}};a.prototype._saveAjaxSuccess=function(c,b){if(typeof this.options.editSuccessHandler==="function"){this.options.editSuccessHandler.call(this,c)}if(this.options.editOnly){return}this.$readOnly.html($(c.Html).html());this._switchToReadOnly()};a.prototype._saveAjaxError=function(b){if(b.Message){var c=this.$editor.data("validator");c.showSummaryError(b.Message)}};a.prototype._evOnCancelClick=function(b){b.preventDefault();this._switchToReadOnly()};a.prototype._switchToEditable=function(){this.$readOnly.hide();this.$editor.show();this.$controls.show();this.$header.data("editmode",true);this.$header.removeClass("editable")};a.prototype._switchToReadOnly=function(){this.$readOnly.show();this.$editor.hide();this.$controls.hide();this.$header.data("editmode",false);this.$header.addClass("editable")};a.prototype._destroy=function(){this.element.removeClass("bs-editable_applied")};$.widget("bforms.bsEditable",a.prototype);return a});define("bforms-form",["jquery","bforms-extensions","jquery-ui-core","bforms-validate-unobtrusive","bforms-initUI","bforms-ajax"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={uniqueName:null,hasGroupToggle:false,style:{},groupToggleSelector:".bs-selector",actions:[]};a.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"form needs a unique name or the element on which it is aplied has to have an id attr"}this._buttons=new Array();this._initSelectors();this._addDelegates();this._addActions(this.options.actions);var b=this.$form.bsInitUI(this.options.style);b.done($.proxy(function(){this._trigger("afterInitUI",0,{name:this.options.uniqueName,form:this.$form})},this))};a.prototype._initSelectors=function(){this.$form=this.element.find("form")};a.prototype._addDelegates=function(){if(this.options.hasGroupToggle){this.element.find(this.options.groupToggleSelector).on("click",$.proxy(this._evToggleGroup,this))}};a.prototype._addActions=function(b){if(b){for(var c=0;c<b.length;c++){this._addAction(b[c])}}};a.prototype._addAction=function(c){var b=this.element.find(c.selector);if(b.length==0){throw"element with selector "+c.selector+" is not found in form container "+this.options.uniqueName}b.on("click",{buttonOpt:c,handlerContext:this.options.handlerContext},$.proxy(this._evBtnClick,this));this._buttons.push({name:c.name,elem:b})};a.prototype._evBtnClick=function(g){g.preventDefault();var b=$(g.currentTarget);var d=g.data.buttonOpt;var h=g.data.handlerContext;if(d.validate){$.validator.unobtrusive.parse(this.$form);var i=this.$form.validate();this._trigger("beforeFormValidation",0,{validator:i,form:this.$form,name:this.options.uniqueName});if(!this.$form.valid()){return}}var f;if(d.parse){f=this._parse();if(typeof d.getExtraData==="function"){d.setExtraData.call(this,f)}}var c=b.data("action");if(c){$.bforms.ajax({name:this.options.uniqueName,url:c,data:f,callbackData:{handler:d.handler,handlerContext:h,sent:f},context:this,success:$.proxy(this._btnClickAjaxSuccess,this),error:$.proxy(this._btnClickAjaxError,this),loadingElement:this.element,loadingClass:"loading"})}else{if(typeof d.handler!=="function"){throw"action "+d.name+" must implement an event handler or have an url option"}d.handler.call(this,f)}};a.prototype._parse=function(){return this.element.parseForm()};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c,this)}};a.prototype._btnClickAjaxError=function(b){if(b.Message){var c=this.$form.data("validator");c.showSummaryError(b.Message)}};a.prototype._evToggleGroup=function(c){var b=$(c.currentTarget);b.toggleClass("open").parent().next().slideToggle()};a.prototype.getFormData=function(b){var c=this.element.find("form");c.removeData("validator");c.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(c);var d=c.validate();this._trigger("beforeFormValidation",0,{validator:d,form:c,name:this.options.uniqueName});if(c.valid()){b=this.element.parseForm()}};a.prototype.parse=function(b){return this._parse()};a.prototype.reset=function(b){this.element.bsResetForm(true)};$.widget("bforms.bsForm",a.prototype);return a});(function(a){if(typeof define==="function"&&define.amd){define("bforms-inlineQuestion",["jquery","bootstrap","jquery-ui-core","icanhaz"],a)}else{a(window.jQuery)}})(function(a){var b=function(c){this.options=a.extend(true,{},this.options,c)};b.prototype.options={template:'<div class="popover fade bottom in"><div class="arrow"></div><div class="popover-content"><p>{{question}}</p><hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button>{{/buttons}}</div></div>'};b.prototype._init=function(){this.$element=this.element;ich.addTemplate("renderPopoverQuestion",this.options.template);this._addPopover()};b.prototype._delegateEvents=function(){var d=0,f=this.options.buttons;for(d;d<f;d++){var c=this.options.buttons[d],g=this;(function(h){this.$element.on("click",".bs-popoverBtn",a.proxy(function(){e.preventDefault();e.stopPropagation();h.callback.apply(this,arguments)},g))})(c,this)}};b.prototype._addPopover=function(){this.$element.popover({html:true,placement:this.options.placement,content:this._renderPopover()});this.$tip=this.$element.data("bs.popover").tip();this._delegateEvents()};b.prototype._renderPopover=function(){console.log(ich.renderPopoverQuestion(this.options,true));return ich.renderPopoverQuestion(this.options,true)};a.widget("bforms.bsPopover",b.prototype)});define("bforms-toolbar-advancedSearch",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="advancedSearch";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_advanced_search"};a.prototype.init=function(){var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}var b=this.$container.find(this._defaultOptions.selector);this.$searchForm=this.$container.bsForm({container:b.attr("id"),actions:c})};a.prototype._addDefaultOptions=function(){var c={name:"search",selector:".js-btn-search",validate:false,parse:true,handler:$.proxy(this._evOnSearch,this)};this._controls.search=c;var b={name:"reset",selector:".js-btn-reset",validate:false,parse:true,handler:$.proxy(this._evOnReset,this)};this._controls.reset=b};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnSearch=function(b){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("search",b)}};a.prototype._evOnReset=function(){this.$searchForm.bsForm("reset");var b={};this.$searchForm.bsForm("getFormData",b);for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("reset",b)}};return a});define("bforms-toolbar-add",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="add";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_add"};a.prototype.init=function(){var b=this.$container.find(this._defaultOptions.selector);var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}this.$addForm=this.$container.bsForm({container:b.attr("id"),actions:c})};a.prototype._addDefaultOptions=function(){var b={name:"save",selector:".js-btn-save",validate:true,parse:true,handler:$.proxy(this._evOnAdd,this)};this._controls.save=b;var c={name:"reset",selector:".js-btn-reset",validate:false,parse:false,handler:$.proxy(this._evOnReset,this)};this._controls.reset=c};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnAdd=function(b,d){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("add",d.Row)}this.$addForm.bsForm("reset")};a.prototype._evOnReset=function(b){this.$addForm.bsForm("reset")};return a});define("bforms-toolbar-quickSearch",["jquery"],function(){var a=function(b,c){this.name="quickSearch";this.type="custom";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c)};a.prototype._defaultOptions={selector:".bs-quick_search",instant:true,timeout:250};a.prototype.init=function(){this.widget=this.$toolbar.data("bformsBsToolbar");this.$toolbar.on("keyup",this.options.selector+" .bs-text",$.proxy(this._evOnQuickSearchKeyup,this))};a.prototype._evOnQuickSearchKeyup=function(d){var b=$(d.currentTarget);var f=b.val().trim();if(f.length==0&&b.data("empty")){return}var c=this.widget.getControl("advancedSearch");if(c!=null&&c.$element.hasClass("selected")){c.$element.trigger("click")}if(f.length==0){b.data("empty",true)}else{b.data("empty",false)}if(this.options.instant){window.clearTimeout(this.quickSearchTimeout);this.quickSearchTimeout=window.setTimeout($.proxy(function(){this._search(f)},this),this.options.timeout)}else{if(d.which==13||d.keyCode==13){this._search(f)}}};a.prototype._search=function(c){for(var b=0;b<this.widget.subscribers.length;b++){this.widget.subscribers[b].bsGrid("search",c,true)}};return a});(function(a){if(typeof define==="function"&&define.amd){define("bforms-themeSelect",["jquery","jquery-ui-core","amplify"],a)}else{a(window.jQuery)}}(function(a){var b=requireConfig.websiteOptions;String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var c=function(){};c.prototype.options={targets:"body, .form_container, .grid_toolbar, .grid_view, .bs-datetime-picker, .bs-range-picker, .bs-pager",startTheme:b.startTheme,themeEnum:b.themeEnum,availableColors:"turqoise orange green blue purple black",toggleSelector:".bs-toggleThemeSelect",openSelector:".bs-selectThemeOpen",closeSelector:".bs-selectThemeClose",defaultTheme:"turqoise",optionsSelector:".bs-selectThemeOptions",localStorageSave:false,ajaxSaveUrl:b.saveThemeUrl};c.prototype._init=function(){this.$element=this.element;this._currentColor=this.options.startTheme||"Default";if(this._currentColor=="Default"){this._isDefaultSelected=true}this._currentColorClass=this._currentColor.toLowerCase();this._isOpen=this.$element.find(this.options.closeSelector).is(":visible");if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}this._addDelegates();this._restoreState()};c.prototype._addDelegates=function(){this.$element.on("click",this.options.optionsSelector+" a",a.proxy(this._onColorSelect,this));this.$element.on("click",this.options.toggleSelector,a.proxy(this._onToggleClick,this))};c.prototype._onColorSelect=function(f){f.preventDefault();var d=a(f.currentTarget);if(d.data("isdefault")){this._isDefaultSelected=true}else{this._isDefaultSelected=false}var g=d.data("color");this.setColor(g)};c.prototype._onToggleClick=function(d){d.preventDefault();if(this._isOpen){this.close()}else{this.open()}};c.prototype.setColor=function(d){try{a(this.options.targets).removeClass(this.options.availableColors);a(this.options.targets).removeClass(d);a(this.options.targets).addClass(d);this._currentColor=d;this._currentColorClass=d;if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}else{this.$element.find('*[data-isdefault="true"]').parent().show()}}catch(f){throw"Invalid targets for themeSelect"}this._saveState()};c.prototype.getCurrentColorClass=function(){return this._currentColorClass};c.prototype.open=function(){this.element.find(this.options.openSelector).hide();this.element.find(this.options.closeSelector).show();this.element.removeClass("collapsed");this._isOpen=true};c.prototype.close=function(){this.element.find(this.options.closeSelector).hide();this.element.find(this.options.openSelector).show();this.element.addClass("collapsed");this._isOpen=false};c.prototype._saveState=function(){if(this.options.localStorageSave){var d={Theme:this._currentColor.toUpperCaseFirst(),Open:this._isOpen};amplify.store("themeSelect",d)}if(this.options.ajaxSaveUrl!=null){a.ajax({url:this.options.ajaxSaveUrl,data:{Theme:this._isDefaultSelected?"Default":this.options.themeEnum[this._currentColor.toUpperCaseFirst()],Open:this._isOpen,},type:"POST"})}};c.prototype._restoreState=function(){if(this.options.localStorageSave===true){var e=amplify.store("themeSelect");if(typeof e!=="undefined"&&e!=null){if(e.Theme){var d=e.Theme.toLowerCase();this.setColor(d)}if(e.open){this.open()}}}};a.widget("bforms.bsThemeSelect",c.prototype);return c}));define("bforms-ajax",["bforms-namespace","jquery"],function(){var a=function(){this._xhrStack={}};a.prototype._defOptions={cache:false,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",context:null,registerGlobal:true,killPrevious:true,loadingDelay:100};a.prototype._getStack=function(){return this._xhrStack};a.prototype._statusEnum={Success:1,ValidationError:2,Denied:3,ServerError:4};a.prototype.getAjaxOptions=function(){return $.extend(true,{},this._defOptions)};a.prototype._updateXHRSettings=function(b){var c=$.extend(true,{},b);c.data=b.contentType===this._defOptions.contentType?JSON.stringify(this._serializeJsonData(b.data)):b.data;return c};a.prototype._serializeJsonData=function(b){var d;if(b instanceof Array){d=b.slice(0)}else{d=$.extend(true,{},b)}for(var c in d){if(d.hasOwnProperty(c)){if(typeof d[c]==="number"){d[c]+=""}else{if(typeof d[c]==="object"){d[c]=this._serializeJsonData(d[c])}}}}return d};a.prototype._killPrevious=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null&&typeof c.jqXHR.abort==="function"&&c.finished!==true){c.aborted=true;c.finished=true;c.jqXHR.abort();this._xhrStack[b]=c;this._toggleLoading(c,true)}};a.prototype._toggleLoading=function(f,e){var c=typeof f==="string"?this._xhrStack[f]:f,d=(typeof c!=="undefined"&&c.settings.loadingClass!=="undefined")?c.settings.loadingClass:this._defaultLoadingClass;if(typeof c!=="undefined"&&typeof c.settings!=="undefined"){var b=c.settings.loadingElement;if(b!=null&&b.length){window.clearTimeout(this.loadingTimeout);if(e){this.loadingTimeout=window.setTimeout(function(){d==null?b.show():b.addClass(d)},c.settings.loadingDelay)}else{d==null?b.hide():b.removeClass(d)}}}};a.prototype.ajax=function(f,b){var h=false;if(typeof File!=="undefined"){for(var e in f.data){if(f.data.hasOwnProperty(e)){if(f.data[e] instanceof File){h=true;break}}}}var i=$.extend({},this.getDefaultOptions(),f),d=null;i.name=i.name||i.url;if(i.killPrevious===true){this._killPrevious(i.name)}var c=$.Deferred();c.done($.proxy(function(k,j){if(k===this._statusEnum.Success){if(typeof f.success==="function"){f.success.apply(f.context,j)}}else{if(k===this._statusEnum.ValidationError){if(typeof f.validationError==="function"){f.validationError.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}}if(k===this._statusEnum.ServerError){if(typeof f.serverError==="function"){f.serverError.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}if(k===this._statusEnum.Denied){if(typeof f.denied==="function"){f.denied.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}},this));c.fail($.proxy(function(k,j){if(k===this._statusEnum.ServerError){if(typeof f.serverError==="function"){f.serverError.apply(f.context,j)}}else{if(k===this._statusEnum.Denied){if(typeof f.denied==="function"){f.denied.apply(f.context,j)}}}if(typeof f.error==="function"){f.error.apply(f.context,j)}},this));if(typeof f.complete==="function"){c.always($.proxy(f.complete,f.context))}if(typeof f.progress==="function"){c.progress($.proxy(f.progress,f.context))}if(h){d=this._ajaxWithFiles(i,b,c)}else{d=this._ajaxWithoutFiles(i,b,c)}var g=c.promise();g.abort=d.abort;g.success=c.done;g.error=c.fail;this._toggleLoading(i.name,true);if(typeof b!=="undefined"&&b!=null){b.deferred=c}return g};a.prototype._ajaxWithoutFiles=function(h,c,d){var f=this;var e=$.extend({},h,{success:function(k,l,j){var m=f._xhrStack[h.name];if(m.aborted===true){return}try{if(k.Status==f._statusEnum.Success||k.Status==f._statusEnum.ValidationError){d.resolve(k.Status,[k.Data,h.callbackData])}else{d.reject(k.Status,[k,j,l,null,h.callbackData])}}catch(i){window.console.log(i.stack)}},error:function(k,m,i){var n=f._xhrStack[h.name];if(typeof n!=="undefined"&&n!=null&&n.aborted===true){return}try{if(typeof k.responseText!=="undefined"){var l=JSON.parse(k.responseText);d.reject(l.Status,[l,k,m,i,h.callbackData])}else{d.reject(f._statusEnum.ServerError,[{Message:i},k,m,i,h.callbackData])}}catch(j){window.console.log(j.stack)}},complete:function(){var i=f._xhrStack[h.name];if(typeof i!=="undefined"){i.finished=true}f._toggleLoading(h.name,false)}});var b=this._updateXHRSettings(e);var g=this._xhrStack[h.name]={jqXHR:$.ajax(b),aborted:false,settings:h};return g.jqXHR};a.prototype._ajaxWithFiles=function(f,b,d){var h=new XMLHttpRequest(),c=new FormData(),g=this;for(var e in f.data){if(f.data.hasOwnProperty(e)){c.append(e,f.data[e])}}f.contentType="";$.extend(true,h,$.extend(true,{},this.getDefaultOptions(),f));h.upload.addEventListener("progress",$.proxy(function(i){i.progress=i.progress/i.total;d.notifyWith(i,f.callbackData)},this));h.onreadystatechange=$.proxy(function(i){var k=this._xhrStack[h.name];if(h.readyState===4&&k.aborted!==true){var j=JSON.parse(h.responseText);if(j.Status==g._statusEnum.Success||j.Status==g._statusEnum.ValidationError){d.resolve(j.Status,[j,f.callbackData])}else{d.reject(j.Status,[j!=null?null:j.Data,jqXHR,textStatus,errorThrown,f.callbackData])}g._toggleLoading(f.name,false)}},this);h.open("POST",f.url,true);h.send(c);this._xhrStack[f.name]={jqXHR:h,aborted:false,settings:f};return this._xhrStack[f.name].jqXHR};a.prototype.getDefaultOptions=function(){return $.extend(true,{},this._defOptions)};a.prototype.abort=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null){c.jqXHR.abort();c.aborted=true}};$.extend(true,$.bforms,new a());return a});/*
 * BForms v1.0.0 Alpha
 * http://bforms.stefanprodan.eu
 *
 * Copyright 2013 Stefan Prodan and contributors
 * http://github.com/stefanprodan/BForms/contributors
 * Licensed under the MIT license
 */
define("bforms-namespace",["jquery","jquery-migrate"],function(a){a.nsx=function(d){var f=d.split("."),e=a,c;if(f[0]==="$"){f=f.slice(1)}else{if(f[0]==="jQuery"){f=f.slice(1)}}for(c=0;c<f.length;c+=1){if(typeof e[f[c]]==="undefined"){e[f[c]]={}}e=e[f[c]]}return e};a.nsx("bforms");var b=function(){};b.prototype.scrollToElement=function(e){var c=$(e);if(c.length>0){var h=a.bforms.getViewport();var g=$(e).offset().top;var f=h.height/2;var d=g;if(f<g){d=g-f}else{d=0}if($.browser.msie&&$.browser.mobile){$("html").scrollTop(d)}else{$("html,body").animate({scrollTop:d},500)}}};b.prototype.getViewport=function(){var i=window,c=document,f=c.documentElement,h=c.getElementsByTagName("body")[0],j=i.innerWidth||f.clientWidth||h.clientWidth,k=i.innerHeight||f.clientHeight||h.clientHeight;return{width:j,height:k}};b.prototype.param=function(c,g){var e,f=[],d=function(h,i){i=a.isFunction(i)?i():(i==null?"":i);f[f.length]=encodeURIComponent(h)+"="+encodeURIComponent(i)};if(g===undefined){g=a.ajaxSettings&&a.ajaxSettings.traditional}if(a.isArray(c)||(c.jquery&&!a.isPlainObject(c))){a.each(c,function(){d(this.name,this.value)})}else{for(e in c){this.buildParams(e,c[e],g,d)}}return f.join("&").replace("/%20/g","+")};b.prototype.buildParams=function(f,e,g,c){var d;if(a.isArray(e)){a.each(e,$.proxy(function(h,j){if(g||/\[\]$/.test(f)){c(f,j)}else{this.buildParams(f+"["+h+"]",j,g,c)}},this))}else{if(!g&&a.type(e)==="object"){for(d in e){this.buildParams(f+"."+d,e[d],g,c)}}else{c(f,e)}}};$.extend(true,$.bforms,new b());return b});